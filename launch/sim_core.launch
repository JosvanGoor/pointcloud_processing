<launch>
    <arg name = "map" default = "map_sim" />
    <arg name = "mapping" default = "false" />
    <arg name = "robot" default="tiago" />
    <arg name = "rviz" default = "false" />
    <arg name = "sim" default = "true" />
    
    <env name="GAZEBO_MODEL_PATH" value="$(find simulation)/models"/>

    <!-- Run the sim -->
    <group if = "$(eval sim == true)">
        <include file="$(find gazebo_ros)/launch/empty_world.launch">
            <arg name="world_name" value="$(find pointcloud_processing)/worlds/explore_world.world"/> <!-- Note: the world_name is with respect to GAZEBO_RESOURCE_PATH environmental variable -->
            <arg name="paused" value="false"/>
            <arg name="use_sim_time" value="true"/>
            <arg name="gui" value="true"/>
            <arg name="recording" value="false"/>
            <arg name="debug" value="false"/>
        </include>
        <include file = "$(find simulation)/launch/$(arg robot)_robot.launch"/>
    </group>

    <!-- Run the map + nav -->
    <group if = "$(eval mapping == false)">
        <include file = "$(find navigation)/launch/tiago_nav.launch">
            <arg name = "map" value = "$(arg map)"/>
        </include>
    </group>
    
    <group if = "$(eval mapping == true)">
        <include file = "$(find pointcloud_processing)/launch/highres_gmapping.launch">
            <arg name = "map_update_interval" default = "2.5"/>
            <arg name = "srr" default = "0.1"/>
            <arg name = "srt" default = "0.2"/>
            <arg name = "str" default = "0.1"/>
            <arg name = "stt" default = "0.2"/>
            <arg name = "linearUpdate" default = "0.5"/>
            <arg name = "angularUpdate" default = "0.25"/>
        </include>
    </group>

    <!-- Run rviz -->
    <group if = "$(eval rviz == true)">
        <node
            name = "rviz"
            pkg = "rviz"
            type = "rviz"
            args = "-d $(find pointcloud_processing)/config/rviz_pointcloud.rviz"
        />
    </group>

</launch>

